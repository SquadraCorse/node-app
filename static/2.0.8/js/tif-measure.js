var AFKL=window.AFKL||{};define(["v2/lib/jquery","v2/lib/lodash","tif/constants","v2/g-mi"],function(e,t,n){AFKL.mi=AFKL.mi||[],AFKL.mi.push(["_add",{TC:{tif:{z_country:n.country,z_language:n.language,z_application:"TIF",z_app_version:n.version,cg_n:"TIF",z_host:"KL"},"tif.page":{},"tif.page.search":{ti:"Travel guide - KLM.com",cg_s:"results"},"tif.page.search.onload":{z_event:"offered",z_eventplace:"results page"},"tif.page.search:onclick":{z_event:"clicked",z_eventplace:"results page"},"tif.page.search.change":{z_event:"clicked",z_eventplace:"results page"},"tif.page.search.viewtoggle":{z_eventtype:"view",z_eventvalue:function(){return this.element.getAttribute("data-event-value")}},"tif.page.search.filter":{z_eventvalue:function(){return this.element.getAttribute("data-event-value")}},"tif.page.search.filter.continent":{z_eventtype:"continent filter"},"tif.page.search.filter.country":{z_eventtype:"country filter"},"tif.page.search.filter.theme":{z_eventtype:"theme filter"},"tif.page.search.change.budgetfilter":{z_eventtype:"budget filter"},"tif.page.search.change.freetextfilter":{z_eventtype:"freetext filter"},"tif.page.search.filter.crumb":{z_eventtype:"filter crumb"},"tif.page.search.change.sort":{z_eventtype:"sort"},"tif.page.search.filter.breadcrumb":{z_eventtype:"bread crumb"},"tif.page.search.change.origin":{z_eventtype:"origin"},"tif.page.destination":{ti:n.destName,cg_s:"destination",cg_s1:n.destName,cg_s2:n.activeTab,z_destination:n.destName},"tif.page.destination.onload":{z_event:"offered",z_eventplace:"destination page"},"tif.page.destination:onclick":{z_event:"clicked",z_eventplace:"destination page"},"tif.page.destination.regionfilter":{z_eventtype:"regionfilter",z_eventvalue:function(){return this.element.getAttribute("data-event-value")}},"tif.page.destination.change":{z_event:"clicked",z_eventplace:"destination page"},"tif.page.destination.filter":{z_eventvalue:function(){return this.element.getAttribute("data-event-value")}},"tif.page.destination.filter.continent":{z_eventtype:"continent filter"},"tif.page.destination.filter.country":{z_eventtype:"country filter"},"tif.page.destination.filter.theme":{z_eventtype:"theme filter"},"tif.page.destination.change.budgetfilter":{z_eventtype:"budget filter"},"tif.page.destination.change.freetextfilter":{z_eventtype:"freetext filter"},"tif.page.destination.filter.breadcrumb":{z_eventtype:"bread crumb"},"tif.page.destination.change.origin":{z_eventtype:"origin"},"tif.page.destination.backtosearch":{z_eventtype:"backtosearch",z_eventvalue:"backtosearch"},"tif.page.destination.pricebox":{z_eventtype:"pricebox",z_eventvalue:"pricebox"},"tif.page.destination.tabs":{z_eventtype:"tab",z_eventvalue:function(){return this.element.getAttribute("data-event-value")}}}}]);var r,i,s=["continent","country","theme","budget"],o=function(e,t){r=e,t?(i=t,i.on("reset",a)):r.on("change",u)},u=function(){var e=[],r=[];if(n.storageSupport&&window.sessionStorage.getItem("tif:model")){var i=JSON.parse(window.sessionStorage.getItem("tif:model"));t.each(s,function(n){i[n]&&(t.isArray(i[n])?t.each(i[n],function(t){e.push(n),r.push(t)}):(e.push(n),r.push(i[n])))})}AFKL.mi.push(["_add",{TC:{"tif.page.destination.onload":{z_filter_type:e.join("_")||"",z_filter_value:r.join("_")||"",z_origin:this.get("origin"),z_tab:this.get("tab")}}}])},a=function(){var e=[],n=[];t.each(r.toJSON(),function(r,i){t.contains(s,i)&&t.isArray(r)&&t.each(r,function(t){e.push(i),n.push(t)},this)},this),AFKL.mi.push(["_add",{TC:{"tif.page.search":{z_filter_type:e.join("_"),z_filter_value:n.join("_"),z_refinement:e.length,z_filter_results:i.length,z_origin:r.get("origin")||"",z_sortBy:r.get("sortBy")||"",z_view:r.get("view")||""}}}])},f=function(e,t){var n={};n.TC={},n.TC[e]=t||{},AFKL.mi.push(["_add",n]),AFKL.mi.push(["_measure",e])};return{init:o,send:f}});